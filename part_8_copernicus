# Downloading and visualizing Copernicus data

library(raster)

# install.packages("ncdf4")
library(ncdf4)
library(ggplot2)
library(viridis)

setwd("C:/lab/")

# register and download data from:
# https://land.copernicus.vgt.vito.be/PDF/portal/Application.html

soil_moist <- raster("c_gls_SSM1km_202305090000_CEURO_S1CSAR_V1.2.1.nc")

soil_moist
ncell(soil_moist)

plot(soil_moist)

soil_moist_d <- as.data.frame(soil_moist, xy = T)

colnames(soil_moist_d)

ggplot() +
  geom_raster(soil_moist_d, mapping = aes(x = x, y = y,
                                       fill = Surface.Soil.Moisture))
 # fill = third column of the dataframe

# crop
ext <- c(23, 30, 62, 68)
soil_moist_crop <- crop(soil_moist, ext)
soil_moist_crop

# plotting with ggplot
soil_moist_crop_d <- as.data.frame(soil_moist_crop, xy= T)
ggplot() +
  geom_raster(soil_moist_crop_d, mapping = aes(x = x, y = y,
                                             fill = Surface.Soil.Moisture)) +
  ggtitle("Cropped soil moisture from Copernicus") +
  scale_fill_viridis()

